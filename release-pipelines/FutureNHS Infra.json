{"source":2,"revision":103,"description":null,"createdBy":{"displayName":"Tim Hunt","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/205138de-d811-450f-ab18-480a9f47dedc","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"}},"id":"205138de-d811-450f-ab18-480a9f47dedc","uniqueName":"timothy.hunt@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1","descriptor":"aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"},"createdOn":"2022-08-28T14:33:22.630Z","modifiedBy":{"displayName":"ian.king","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/2656de32-9618-449c-9f22-19f31779dcbd","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NWFkZmUxOGYtNzJkYi03Mjk5LTllYWEtNzM5ZDMwNWEyNmM5"}},"id":"2656de32-9618-449c-9f22-19f31779dcbd","uniqueName":"ian.king@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NWFkZmUxOGYtNzJkYi03Mjk5LTllYWEtNzM5ZDMwNWEyNmM5","descriptor":"aad.NWFkZmUxOGYtNzJkYi03Mjk5LTllYWEtNzM5ZDMwNWEyNmM5"},"modifiedOn":"2022-11-25T10:45:51.457Z","isDeleted":false,"lastRelease":{"id":2305,"name":"Release-235","artifacts":[],"_links":{},"description":"Triggered by FutureNHS Infra 20221219.1.","releaseDefinition":{"id":42,"projectReference":null,"_links":{}},"createdOn":"2022-12-19T14:11:16.960Z","createdBy":{"displayName":"Microsoft.VisualStudio.Services.TFS","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/00000002-0000-8888-8000-000000000000","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/s2s.MDAwMDAwMDItMDAwMC04ODg4LTgwMDAtMDAwMDAwMDAwMDAwQDJjODk1OTA4LTA0ZTAtNDk1Mi04OWZkLTU0YjAwNDZkNjI4OA"}},"id":"00000002-0000-8888-8000-000000000000","uniqueName":"00000002-0000-8888-8000-000000000000@2c895908-04e0-4952-89fd-54b0046d6288","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/s2s.MDAwMDAwMDItMDAwMC04ODg4LTgwMDAtMDAwMDAwMDAwMDAwQDJjODk1OTA4LTA0ZTAtNDk1Mi04OWZkLTU0YjAwNDZkNjI4OA","descriptor":"s2s.MDAwMDAwMDItMDAwMC04ODg4LTgwMDAtMDAwMDAwMDAwMDAwQDJjODk1OTA4LTA0ZTAtNDk1Mi04OWZkLTU0YjAwNDZkNjI4OA"}},"variables":{},"variableGroups":[],"environments":[{"id":60,"name":"Dev","rank":1,"owner":{"displayName":"Tim Hunt","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/205138de-d811-450f-ab18-480a9f47dedc","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"}},"id":"205138de-d811-450f-ab18-480a9f47dedc","uniqueName":"timothy.hunt@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1","descriptor":"aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"},"variables":{"terraform.appgw_tls_certificate_base64":{"value":null,"isSecret":true}},"variableGroups":[98,112],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":225}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":217},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":218}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":1388,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Deploy","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 1.2.8","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"1.2.8"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/dev","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"8dbfc4f9-5f94-4b97-afeb-a5c7c957fc74","backendAzureRmResourceGroupName":"rg-fnhs-uksouth","backendAzureRmStorageAccountName":"stfnhsuksouth","backendAzureRmContainerName":"terraform","backendAzureRmKey":"$(azure.tfstatefile.name)","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : validate","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"validate","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/dev","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : plan","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/dev","commandOptions":"-no-color -out=\"$(terraform.plan.name).tfplan\" -input=false -var=\"product_name=$(terraform.product_name)\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/change-password-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/change-password.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/default.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/error.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-4.1.0.min.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-is-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signin-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signin.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signup-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signup.html\\\"]\" -var=\"location=$(terraform.location)\" -var=\"environment=$(terraform.environment)\" -var=\"sqlserver_admin_email=$(terraform.sqlserver_admin_email)\" -var=\"sqlserver_admin_user_id=$(terraform.sqlserver_admin_user_id)\" -var=\"sqlserver_admin_password=$(terraform.sqlserver_admin_password)\" -var=\"security_center_contact_email=$(terraform.security_center_contact_email)\" -var=\"security_center_contact_phone=$(terraform.security_center_contact_phone)\" -var=\"appgw_tls_certificate_password=$(terraform.appgw_tls_certificate_password)\" -var=\"appgw_tls_certificate_base64=$(terraform.appgw_tls_certificate_base64)\" -var=\"appgw_tls_certificate_content_type=$(terraform.appgw_tls_certificate_content_type)\" -var=\"sqlserver_active_directory_administrator_login_name=$(terraform.sqlserver_active_directory_administrator_login_name)\" -var=\"sqlserver_active_directory_administrator_objectid=$(terraform.sqlserver_active_directory_administrator_objectid)\" -var=\"application_fqdn=$(terraform.application_fqdn)\" -var=\"forum_email_sendgrid_apikey=$(terraform.forum_email_sendgrid_apikey)\" -var=\"forum_email_smtp_from=$(terraform.forum_email_smtp_from)\" -var=\"forum_email_smpt_username=$(terraform.forum_email_smpt_username)\" -var=\"api_forum_application_shared_secret=$(terraform.api_forum_application_shared_secret)\" -var=\"web_cookie_parser_secret=$(terraform.web_cookie_parser_secret)\" -var=\"api_govnotify_api_key=$(terraform.api_govnotify_api_key)\" -var=\"api_govnotify_registration_template_id=$(terraform.api_govnotify_registration_template_id)\" -var=\"api_govnotify_group_registration_template_id=$(terraform.api_govnotify_group_registration_template_id)\" -var=\"api_govnotify_group_invite_template_id=$(terraform.api_govnotify_group_invite_template_id)\" -var=\"web_next_public_gtm_key=$(terraform.web_next_public_gtm_key)\" -var=\"api_govnotify_group_member_comment_on_discussion=$(terraform.api_govnotify_group_member_comment_on_discussion)\" -var=\"api_govnotify_member_response_to_comment=$(terraform.api_govnotify_member_response_to_comment)\" -var=\"api_govnotify_group_member_request_rejected=$(terraform.api_govnotify_group_member_request_rejected)\" -var=\"api_govnotify_group_member_request_accepted__platform_user=$(terraform.api_govnotify_group_member_request_accepted__platform_user)\" -var=\"api_govnotify_group_member_request_rejected_platform_user=$(terraform.api_govnotify_group_member_request_rejected_platform_user)\" -var=\"api_govnotify_group_membership_request=$(terraform.api_govnotify_group_membership_request)\" -var=\"b2c_application_name=$(terraform.b2c_application_name)\" -var=\"b2c_domain_name=$(terraform.b2c_domain_name)\" -var=\"tenant_id=$(tennant.id)\" -var=\"web_nextauth_secret=$(terraform.web_nextauth_secret)\" -var=\"web_azure_ad_b2c_tenant_name=$(terraform.web_azure_ad_b2c_tenant_name)\" -var=\"web_azure_ad_b2c_client_id=$(terraform.web_azure_ad_b2c_client_id)\" -var=\"web_azure_ad_b2c_client_secret=$(terraform.web_azure_ad_b2c_client_secret)\" -var=\"web_azure_ad_b2c_primary_user_flow=$(terraform.web_azure_ad_b2c_primary_user_flow)\" -var=\"web_azure_ad_b2c_signup_user_flow=$(terraform.web_azure_ad_b2c_signup_user_flow)\" -var=\"web_azure_ad_b2c_password_reset_user_flow=$(terraform.web_azure_ad_b2c_password_reset_user_flow)\" -var=\"app_configuration_self_register=$(featureflag.self_register)\" -var=\"app_configuration_group_invite=$(featureflag.group_invite)\" ","environmentServiceNameAzureRM":"8dbfc4f9-5f94-4b97-afeb-a5c7c957fc74","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - validate and apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/dev","commandOptions":"-input=false \"$(terraform.plan.name).tfplan\"","environmentServiceNameAzureRM":"8dbfc4f9-5f94-4b97-afeb-a5c7c957fc74","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Azure CLI - Attach in-guest Change Analysis Tracking to all Web Apps (Azure Monitor)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"8dbfc4f9-5f94-4b97-afeb-a5c7c957fc74","scriptType":"ps","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"Register-AzResourceProvider -ProviderNamespace \"Microsoft.ChangeAnalysis\"\n\n$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}\nforeach ($webapp in $webapp_list)\n{\n    $tags = $webapp.Tags\n    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true\n    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force\n}","scriptArguments":"","powerShellErrorActionPreference":"silentlyContinue","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":1},"schedules":[],"currentRelease":{"id":2305,"url":"https://nhsidev.vsrm.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_apis/Release/releases/2305","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://nhsidev.vsrm.visualstudio.com/_apis/public/Release/badge/b796db6a-8c40-49c5-8132-f13e9126cc35/42/60"},{"id":63,"name":"UAT","rank":2,"owner":{"displayName":"Tim Hunt","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/205138de-d811-450f-ab18-480a9f47dedc","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"}},"id":"205138de-d811-450f-ab18-480a9f47dedc","uniqueName":"timothy.hunt@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1","descriptor":"aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"},"variables":{"terraform.appgw_tls_certificate_base64":{"value":null,"isSecret":true}},"variableGroups":[110,113],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":228}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":229},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":230}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":1388,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Deploy","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 1.2.8","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"1.2.8"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/uat","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"2df8205d-539a-4f12-92e6-f7e48e19db79","backendAzureRmResourceGroupName":"rg-fnhs-uat-uksouth","backendAzureRmStorageAccountName":"stfnhsuatuksouth","backendAzureRmContainerName":"terraform","backendAzureRmKey":"$(azure.tfstatefile.name)","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : validate","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"validate","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/uat","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : plan","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/uat","commandOptions":"-no-color -out=\"$(terraform.plan.name).tfplan\" -input=false -var=\"product_name=$(terraform.product_name)\" -var=\"location=$(terraform.location)\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/change-password-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/change-password.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/default.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/error.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-4.1.0.min.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-is-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signin-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signin.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signup-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signup.html\\\"]\" -var=\"location=$(terraform.location)\" -var=\"environment=$(terraform.environment)\" -var=\"environment=$(terraform.environment)\" -var=\"sqlserver_admin_email=$(terraform.sqlserver_admin_email)\" -var=\"sqlserver_admin_user_id=$(terraform.sqlserver_admin_user_id)\" -var=\"sqlserver_admin_password=$(terraform.sqlserver_admin_password)\" -var=\"security_center_contact_email=$(terraform.security_center_contact_email)\" -var=\"security_center_contact_phone=$(terraform.security_center_contact_phone)\" -var=\"appgw_tls_certificate_password=$(terraform.appgw_tls_certificate_password)\" -var=\"appgw_tls_certificate_base64=$(terraform.appgw_tls_certificate_base64)\" -var=\"appgw_tls_certificate_content_type=$(terraform.appgw_tls_certificate_content_type)\" -var=\"sqlserver_active_directory_administrator_login_name=$(terraform.sqlserver_active_directory_administrator_login_name)\" -var=\"sqlserver_active_directory_administrator_objectid=$(terraform.sqlserver_active_directory_administrator_objectid)\" -var=\"application_fqdn=$(terraform.application_fqdn)\" -var=\"forum_email_sendgrid_apikey=$(terraform.forum_email_sendgrid_apikey)\" -var=\"forum_email_smtp_from=$(terraform.forum_email_smtp_from)\" -var=\"forum_email_smpt_username=$(terraform.forum_email_smpt_username)\" -var=\"api_forum_application_shared_secret=$(terraform.api_forum_application_shared_secret)\" -var=\"web_cookie_parser_secret=$(terraform.web_cookie_parser_secret)\" -var=\"api_govnotify_api_key=$(terraform.api_govnotify_api_key)\" -var=\"api_govnotify_registration_template_id=$(terraform.api_govnotify_registration_template_id)\" -var=\"api_govnotify_group_registration_template_id=$(terraform.api_govnotify_group_registration_template_id)\" -var=\"api_govnotify_group_invite_template_id=$(terraform.api_govnotify_group_invite_template_id)\" -var=\"web_next_public_gtm_key=$(terraform.web_next_public_gtm_key)\" -var=\"api_govnotify_group_member_comment_on_discussion=$(terraform.api_govnotify_group_member_comment_on_discussion)\" -var=\"api_govnotify_member_response_to_comment=$(terraform.api_govnotify_member_response_to_comment)\" -var=\"api_govnotify_group_member_request_rejected=$(terraform.api_govnotify_group_member_request_rejected)\" -var=\"api_govnotify_group_member_request_accepted__platform_user=$(terraform.api_govnotify_group_member_request_accepted__platform_user)\" -var=\"api_govnotify_group_member_request_rejected_platform_user=$(terraform.api_govnotify_group_member_request_rejected_platform_user)\" -var=\"api_govnotify_group_membership_request=$(terraform.api_govnotify_group_membership_request)\" -var=\"b2c_application_name=$(terraform.b2c_application_name)\" -var=\"b2c_domain_name=$(terraform.b2c_domain_name)\" -var=\"tenant_id=$(tennant.id)\" -var=\"web_nextauth_secret=$(terraform.web_nextauth_secret)\" -var=\"web_azure_ad_b2c_tenant_name=$(terraform.web_azure_ad_b2c_tenant_name)\" -var=\"web_azure_ad_b2c_client_id=$(terraform.web_azure_ad_b2c_client_id)\" -var=\"web_azure_ad_b2c_client_secret=$(terraform.web_azure_ad_b2c_client_secret)\" -var=\"web_azure_ad_b2c_primary_user_flow=$(terraform.web_azure_ad_b2c_primary_user_flow)\" -var=\"web_azure_ad_b2c_signup_user_flow=$(terraform.web_azure_ad_b2c_signup_user_flow)\" -var=\"web_azure_ad_b2c_password_reset_user_flow=$(terraform.web_azure_ad_b2c_password_reset_user_flow)\" -var=\"app_configuration_self_register=$(featureflag.self_register)\" -var=\"app_configuration_group_invite=$(featureflag.group_invite)\" ","environmentServiceNameAzureRM":"2df8205d-539a-4f12-92e6-f7e48e19db79","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - validate and apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/uat","commandOptions":"-input=false \"$(terraform.plan.name).tfplan\"","environmentServiceNameAzureRM":"2df8205d-539a-4f12-92e6-f7e48e19db79","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Azure CLI - Attach in-guest Change Analysis Tracking to all Web Apps (Azure Monitor)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"2df8205d-539a-4f12-92e6-f7e48e19db79","scriptType":"ps","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"Register-AzResourceProvider -ProviderNamespace \"Microsoft.ChangeAnalysis\"\n\n$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}\nforeach ($webapp in $webapp_list)\n{\n    $tags = $webapp.Tags\n    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true\n    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force\n}","scriptArguments":"","powerShellErrorActionPreference":"silentlyContinue","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Dev","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":1},"schedules":[],"currentRelease":{"id":2305,"url":"https://nhsidev.vsrm.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_apis/Release/releases/2305","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://nhsidev.vsrm.visualstudio.com/_apis/public/Release/badge/b796db6a-8c40-49c5-8132-f13e9126cc35/42/63"},{"id":64,"name":"Prod","rank":3,"owner":{"displayName":"Tim Hunt","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/205138de-d811-450f-ab18-480a9f47dedc","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"}},"id":"205138de-d811-450f-ab18-480a9f47dedc","uniqueName":"timothy.hunt@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1","descriptor":"aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"},"variables":{"terraform.appgw_tls_certificate_base64":{"value":null,"isSecret":true}},"variableGroups":[111,114],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"[FutureNHS Open]\\Deployment Approvers","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/4a8d7df6-4df3-4fb7-80c4-b9100d4fd752","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNzkyNzc1ODYzLTEwODI5NjczNjktMjE2NzU5OTQyMi0yNDM1MjM4OTY1LTEtNTQ2MTQ5MzQ0LTI2MDI4NjU3MzctMjI4Mzc2OTUzNS0yNzkyODM5NDY1"}},"id":"4a8d7df6-4df3-4fb7-80c4-b9100d4fd752","uniqueName":"vstfs:///Classification/TeamProject/b796db6a-8c40-49c5-8132-f13e9126cc35\\Deployment Approvers","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNzkyNzc1ODYzLTEwODI5NjczNjktMjE2NzU5OTQyMi0yNDM1MjM4OTY1LTEtNTQ2MTQ5MzQ0LTI2MDI4NjU3MzctMjI4Mzc2OTUzNS0yNzkyODM5NDY1","isContainer":true,"descriptor":"vssgp.Uy0xLTktMTU1MTM3NDI0NS0xNzkyNzc1ODYzLTEwODI5NjczNjktMjE2NzU5OTQyMi0yNDM1MjM4OTY1LTEtNTQ2MTQ5MzQ0LTI2MDI4NjU3MzctMjI4Mzc2OTUzNS0yNzkyODM5NDY1"},"id":234},{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"Tim Hunt","url":"https://spsprodweu1.vssps.visualstudio.com/Ab30cb887-f574-4915-93ec-bc289ef3dc22/_apis/Identities/205138de-d811-450f-ab18-480a9f47dedc","_links":{"avatar":{"href":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"}},"id":"205138de-d811-450f-ab18-480a9f47dedc","uniqueName":"timothy.hunt@madetech.com","imageUrl":"https://nhsidev.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1","descriptor":"aad.NGVkMzJiNTQtYzU0OC03OTk1LTk4ZTAtN2NmMjE0Yjg1NzE1"},"id":235}],"approvalOptions":{"requiredApproverCount":1,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":232},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":233}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2022"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":1388,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Deploy","refName":null,"workflowTasks":[{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform 1.2.8","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"1.2.8"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/prod","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"031c6209-99bd-4e80-aa79-cbd78a503eef","backendAzureRmResourceGroupName":"rg-fnhs-prod-uksouth","backendAzureRmStorageAccountName":"stfnhsproduksouth","backendAzureRmContainerName":"terraform","backendAzureRmKey":"$(azure.tfstatefile.name)","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : validate","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"validate","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/prod","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform : plan","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/prod","commandOptions":"-no-color -out=\"$(terraform.plan.name).tfplan\" -input=false -var=\"product_name=$(terraform.product_name)\" -var=\"location=$(terraform.location)\"-replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/change-password-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/change-password.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/default.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/error.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-4.1.0.min.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/nhsuk-is-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signin-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signin.html\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/css/signup-styles.css\\\"]\" -replace=\"module.b2c.azurerm_storage_blob.b2c_files[\\\"public/html/signup.html\\\"]\" -var=\"location=$(terraform.location)\" -var=\"environment=$(terraform.environment)\" -var=\"sqlserver_admin_email=$(terraform.sqlserver_admin_email)\" -var=\"sqlserver_admin_user_id=$(terraform.sqlserver_admin_user_id)\" -var=\"sqlserver_admin_password=$(terraform.sqlserver_admin_password)\" -var=\"security_center_contact_email=$(terraform.security_center_contact_email)\" -var=\"security_center_contact_phone=$(terraform.security_center_contact_phone)\" -var=\"appgw_tls_certificate_password=$(terraform.appgw_tls_certificate_password)\" -var=\"appgw_tls_certificate_base64=$(terraform.appgw_tls_certificate_base64)\" -var=\"appgw_tls_certificate_content_type=$(terraform.appgw_tls_certificate_content_type)\" -var=\"sqlserver_active_directory_administrator_login_name=$(terraform.sqlserver_active_directory_administrator_login_name)\" -var=\"sqlserver_active_directory_administrator_objectid=$(terraform.sqlserver_active_directory_administrator_objectid)\" -var=\"application_fqdn=$(terraform.application_fqdn)\" -var=\"forum_email_sendgrid_apikey=$(terraform.forum_email_sendgrid_apikey)\" -var=\"forum_email_smtp_from=$(terraform.forum_email_smtp_from)\" -var=\"forum_email_smpt_username=$(terraform.forum_email_smpt_username)\" -var=\"api_forum_application_shared_secret=$(terraform.api_forum_application_shared_secret)\" -var=\"web_cookie_parser_secret=$(terraform.web_cookie_parser_secret)\" -var=\"api_govnotify_api_key=$(terraform.api_govnotify_api_key)\" -var=\"api_govnotify_registration_template_id=$(terraform.api_govnotify_registration_template_id)\" -var=\"api_govnotify_group_registration_template_id=$(terraform.api_govnotify_group_registration_template_id)\" -var=\"api_govnotify_group_invite_template_id=$(terraform.api_govnotify_group_invite_template_id)\" -var=\"web_next_public_gtm_key=$(terraform.web_next_public_gtm_key)\" -var=\"api_govnotify_group_member_comment_on_discussion=$(terraform.api_govnotify_group_member_comment_on_discussion)\" -var=\"api_govnotify_member_response_to_comment=$(terraform.api_govnotify_member_response_to_comment)\" -var=\"api_govnotify_group_member_request_rejected=$(terraform.api_govnotify_group_member_request_rejected)\" -var=\"api_govnotify_group_member_request_accepted__platform_user=$(terraform.api_govnotify_group_member_request_accepted__platform_user)\" -var=\"api_govnotify_group_member_request_rejected_platform_user=$(terraform.api_govnotify_group_member_request_rejected_platform_user)\" -var=\"api_govnotify_group_membership_request=$(terraform.api_govnotify_group_membership_request)\" -var=\"b2c_application_name=$(terraform.b2c_application_name)\" -var=\"b2c_domain_name=$(terraform.b2c_domain_name)\" -var=\"tenant_id=$(tennant.id)\" -var=\"web_nextauth_secret=$(terraform.web_nextauth_secret)\" -var=\"web_azure_ad_b2c_tenant_name=$(terraform.web_azure_ad_b2c_tenant_name)\" -var=\"web_azure_ad_b2c_client_id=$(terraform.web_azure_ad_b2c_client_id)\" -var=\"web_azure_ad_b2c_client_secret=$(terraform.web_azure_ad_b2c_client_secret)\" -var=\"web_azure_ad_b2c_primary_user_flow=$(terraform.web_azure_ad_b2c_primary_user_flow)\" -var=\"web_azure_ad_b2c_signup_user_flow=$(terraform.web_azure_ad_b2c_signup_user_flow)\" -var=\"web_azure_ad_b2c_password_reset_user_flow=$(terraform.web_azure_ad_b2c_password_reset_user_flow)\" -var=\"app_configuration_self_register=$(featureflag.self_register)\" -var=\"app_configuration_group_invite=$(featureflag.group_invite)\" ","environmentServiceNameAzureRM":"031c6209-99bd-4e80-aa79-cbd78a503eef","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"2.*","name":"Terraform - validate and apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"$(System.DefaultWorkingDirectory)/_FutureNHS Infra/FNHSInfra/prod","commandOptions":"-input=false \"$(terraform.plan.name).tfplan\"","environmentServiceNameAzureRM":"031c6209-99bd-4e80-aa79-cbd78a503eef","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"","backendAzureRmResourceGroupName":"","backendAzureRmStorageAccountName":"","backendAzureRmContainerName":"","backendAzureRmKey":"","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Azure CLI - Attach in-guest Change Analysis Tracking to all Web Apps (Azure Monitor)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"031c6209-99bd-4e80-aa79-cbd78a503eef","scriptType":"ps","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"Register-AzResourceProvider -ProviderNamespace \"Microsoft.ChangeAnalysis\"\n\n$webapp_list = Get-AzWebApp | Where-Object {$_.kind -eq 'app'}\nforeach ($webapp in $webapp_list)\n{\n    $tags = $webapp.Tags\n    $tags[“hidden-related:diagnostics/changeAnalysisScanEnabled”]=$true\n    Set-AzResource -ResourceId $webapp.Id -Tag $tags -Force\n}","scriptArguments":"","powerShellErrorActionPreference":"silentlyContinue","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"UAT","conditionType":2,"value":"4"},{"name":"_FutureNHS Infra","conditionType":4,"value":"{\"sourceBranch\":\"main\",\"tags\":[],\"useBuildDefinitionBranch\":false,\"createReleaseOnBuildTagging\":false}"}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":1},"schedules":[],"currentRelease":{"id":2185,"url":"https://nhsidev.vsrm.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_apis/Release/releases/2185","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":244,"gatesOptions":{"isEnabled":true,"timeout":1440,"samplingInterval":15,"stabilizationTime":5,"minimumSuccessDuration":0},"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://nhsidev.vsrm.visualstudio.com/_apis/public/Release/badge/b796db6a-8c40-49c5-8132-f13e9126cc35/42/64"}],"artifacts":[{"sourceId":"b796db6a-8c40-49c5-8132-f13e9126cc35:972","type":"Build","alias":"_FutureNHS Infra","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://nhsidev.visualstudio.com/_permalink/_build/index?collectionId=87146f5a-233f-4a2a-a14e-25deb9023bbe&projectId=b796db6a-8c40-49c5-8132-f13e9126cc35&definitionId=972","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"972","name":"FutureNHS Infra"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"b796db6a-8c40-49c5-8132-f13e9126cc35","name":"FutureNHS Open"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[{"artifactAlias":"_FutureNHS Infra","triggerConditions":[{"sourceBranch":"main","tags":[],"tagFilter":null,"useBuildDefinitionBranch":false,"createReleaseOnBuildTagging":false},{"sourceBranch":"featureflags","tags":[],"tagFilter":null,"useBuildDefinitionBranch":false,"createReleaseOnBuildTagging":false}],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseClone"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":42,"name":"FutureNHS Infra","path":"\\","projectReference":null,"url":"https://nhsidev.vsrm.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_apis/Release/definitions/42","_links":{"self":{"href":"https://nhsidev.vsrm.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_apis/Release/definitions/42"},"web":{"href":"https://nhsidev.visualstudio.com/b796db6a-8c40-49c5-8132-f13e9126cc35/_release?definitionId=42"}}}